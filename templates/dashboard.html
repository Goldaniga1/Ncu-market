<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„å¸‚é›† - NCU äºŒæ‰‹å¸‚é›†</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        /* === å„ªåŒ–äºŒï¼šåˆ†é ç±¤ (Tabs) æ¨£å¼ === */
        .tab-container { display: flex; border-bottom: 2px solid #eee; margin-bottom: 20px; }
        
        .tab-btn {
            padding: 12px 25px; cursor: pointer; font-weight: bold; color: #888;
            border-bottom: 3px solid transparent; transition: 0.3s; font-size: 1.1em;
        }
        
        .tab-btn:hover { color: #333; background: #f9f9f9; }
        
        /* è³£æ±è¥¿ Tab è¢«é¸ä¸­ */
        .tab-btn.active { color: #2c3e50; border-bottom: 3px solid #2c3e50; }
        
        /* å¾µæ±è¥¿ Tab è¢«é¸ä¸­ (æ©˜è‰²) */
        .tab-btn.active-req { color: #e67e22; border-bottom: 3px solid #e67e22; }

        /* éš±è—å€å¡Šç”¨ */
        .tab-content { display: none; animation: fadeIn 0.4s; }

        /* === å„ªåŒ–ä¸‰ï¼šè¦–è¦ºå¾®èª¿ === */
        /* 1. æ›´æŸ”å’Œçš„å¡ç‰‡é™°å½± */
        .product-card, .req-card {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); 
            border: 1px solid #eee;
            border-radius: 12px; /* æ›´åœ“æ½¤çš„å¡ç‰‡ */
            overflow: hidden;
        }

        /* 2. åœ–ç‰‡å¼·åˆ¶ 4:3 æ¯”ä¾‹ï¼Œæ•´é½ŠåŠƒä¸€ */
        .product-img-dashboard {
            width: 100%; 
            aspect-ratio: 4/3; 
            object-fit: cover;
        }

        /* 3. è† å›Šç‹€ç‹€æ…‹æ¨™ç±¤ */
        .status-badge {
            display: inline-block; padding: 4px 12px; border-radius: 20px; 
            font-size: 0.85em; font-weight: bold; margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div style="margin-bottom: 20px;">
            <a href="{{ url_for('home') }}" style="text-decoration: none; color: #666;">â† å›é¦–é </a>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    {% if category == 'success' %}
                        <div style="padding:10px; border-radius:8px; margin-bottom:15px; background: #d4edda; color: #155724; border: 1px solid #c3e6cb;">
                            {{ message }}
                        </div>
                    {% else %}
                        <div style="padding:10px; border-radius:8px; margin-bottom:15px; background: #ffdddd; color: #721c24; border: 1px solid #f5c6cb;">
                            {{ message }}
                        </div>
                    {% endif %}
                {% endfor %}
            {% endif %}
        {% endwith %}

        <h1>æˆ‘çš„å¸‚é›†ç®¡ç† ğŸ’¼</h1>
        <p style="margin-bottom: 30px; color: #666;">å—¨ï¼Œ{{ current_user.name }}ï¼ç®¡ç†ä½ çš„è²©å”®èˆ‡å¾µæ±‚ã€‚</p>

        <div class="tab-container">
            <div class="tab-btn active" onclick="switchTab('products', this)">ğŸ“¦ æˆ‘è³£çš„å•†å“</div>
            <div class="tab-btn" onclick="switchTab('requests', this)">ğŸ™‹â€â™‚ï¸ æˆ‘å¾µçš„ç‰©å“</div>
        </div>

        <div id="tab-products" class="tab-content" style="display: block;">
            <div class="product-grid">
                {% for p in products %}
                    <div class="product-card" 
                        {% if p['status'] == 'sold' %} style="opacity: 0.7; background: #f9f9f9;" {% endif %}>
                        
                        {% if p['image_filename'] %}
                            {% set first_img = p['image_filename'].split(',')[0] %}
                            
                            {% if p['status'] == 'sold' %}
                                <img src="{{ url_for('static', filename='uploads/' + first_img) }}" class="product-img-dashboard"
                                     style="filter: grayscale(100%);">
                            {% else %}
                                <img src="{{ url_for('static', filename='uploads/' + first_img) }}" class="product-img-dashboard">
                            {% endif %}
                        {% else %}
                            <div class="product-img-dashboard" style="display:flex;align-items:center;justify-content:center;color:#ccc;background:#eee;">ç„¡åœ–ç‰‡</div>
                        {% endif %}

                        <div class="product-info">
                            <div style="font-weight: bold; font-size: 1.1em;">{{ p['name'] }}</div>
                            <div class="price-tag" style="font-size: 1.2em;">${{ p['price'] }}</div>
                            
                            {% if p['status'] == 'sold' %}
                                <div class="status-badge" style="background: #95a5a6; color: white;">å·²å”®å‡º SOLD</div>
                            {% else %}
                                <div class="status-badge" style="background: #27ae60; color: white;">è²©å”®ä¸­ ing</div>
                            {% endif %}

                            <div style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px; 
                                        display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                
                                {% if p['status'] == 'active' %}
                                    <form action="{{ url_for('mark_sold', product_id=p['id']) }}" method="POST" style="margin:0;">
                                        <button type="submit" class="btn-primary" 
                                                style="background-color: #f39c12; width: 100%; font-size: 0.9em; padding: 8px; border-radius: 8px;">
                                            ğŸ¤ å·²å”®å‡º
                                        </button>
                                    </form>
                                {% else %}
                                    <form action="{{ url_for('mark_active', product_id=p['id']) }}" method="POST" style="margin:0;">
                                        <button type="submit" class="btn-primary" 
                                                style="background-color: #27ae60; width: 100%; font-size: 0.9em; padding: 8px; border-radius: 8px;">
                                            ğŸ”„ é‡ä¸Šæ¶
                                        </button>
                                    </form>
                                {% endif %}

                                <form action="{{ url_for('delete_product', product_id=p['id']) }}" method="POST" style="margin:0;">
                                    <button type="submit" onclick="return confirm('çœŸçš„è¦åˆªé™¤å—ï¼Ÿç´€éŒ„æœƒæ¶ˆå¤±å–”ï¼');" 
                                            style="width: 100%; padding: 8px; background-color: white; color: #e74c3c; 
                                                   border: 1px solid #e74c3c; border-radius: 8px; cursor: pointer; font-size: 0.9em; transition: 0.2s;">
                                        ğŸ—‘ï¸ åˆªé™¤
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <div style="grid-column: 1 / -1; text-align: center; color: #888; padding: 40px;">
                        <p>ä½ é‚„æ²’è³£éæ±è¥¿å–”ï¼</p>
                        <a href="{{ url_for('home') }}" class="btn-primary" style="display:inline-block; width:auto; border-radius: 20px;">å»ä¸Šæ¶å•†å“</a>
                    </div>
                {% endfor %}
            </div>
        </div>


        <div id="tab-requests" class="tab-content">
            <div style="display: flex; flex-direction: column; gap: 15px; margin-bottom: 50px;">
                {% for r in requests %}
                    <div class="req-card" 
                        {% if r['status'] == 'fulfilled' %} style="background: #f9f9f9; opacity: 0.7;" {% else %} style="background: #fff;" {% endif %}>
                
                        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                            <div>
                                <span style="font-weight: bold; font-size: 1.2em; color: #333;">{{ r['title'] }}</span>
                                <span style="color: #666; margin-left: 10px;">é ç®—ï¼š{{ r['budget'] }}</span>
                            
                                {% if r['status'] == 'fulfilled' %}
                                    <span class="status-badge" style="background: #bdc3c7; color: white; margin-left: 10px;">å·²å¾µåˆ°</span>
                                {% else %}
                                    <span class="status-badge" style="background: #e67e22; color: white; margin-left: 10px;">å¾µæ±‚ä¸­</span>
                                {% endif %}
                            </div>

                            <div style="display: flex; gap: 8px;">
                            
                                {% if r['status'] == 'active' %}
                                    <form action="{{ url_for('fulfill_request', req_id=r['id']) }}" method="POST" style="margin: 0;">
                                        <button type="submit" class="btn-primary" 
                                                style="background: #27ae60; padding: 6px 15px; font-size: 0.9em; width: auto; border-radius: 20px;">
                                            âœ… å·²å¾µåˆ°
                                        </button>
                                    </form>
                                {% endif %}

                                <form action="{{ url_for('delete_request', req_id=r['id']) }}" method="POST" style="margin: 0;">
                                    <button type="submit" onclick="return confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†å¾µæ±‚ç´€éŒ„å—ï¼Ÿ');" 
                                            class="btn-primary" 
                                            style="background: #e74c3c; padding: 6px 15px; font-size: 0.9em; width: auto; border-radius: 20px;">
                                        ğŸ—‘ï¸ åˆªé™¤
                                    </button>
                                </form>
                            </div>

                        </div>
                    </div>
                {% else %}
                    <div style="text-align: center; color: #888; padding: 40px;">
                        <p>ç›®å‰æ²’æœ‰æ­£åœ¨å¾µæ±‚çš„é …ç›®ã€‚</p>
                        <a href="{{ url_for('home') }}" class="btn-primary" style="display:inline-block; width:auto; border-radius: 20px;">å»ç™¼å¸ƒå¾µæ±‚</a>
                    </div>
                {% endfor %}
            </div>
        </div>

    </div>

    <script>
        function switchTab(tabName, btn) {
            // 1. éš±è—æ‰€æœ‰å…§å®¹å€å¡Š
            document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
            
            // 2. ç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„ active ç‹€æ…‹
            document.querySelectorAll('.tab-btn').forEach(el => {
                el.classList.remove('active');
                el.classList.remove('active-req');
            });

            // 3. é¡¯ç¤ºè¢«é¸ä¸­çš„å…§å®¹å€å¡Š
            document.getElementById('tab-' + tabName).style.display = 'block';
            
            // 4. å¹«è¢«é»æ“Šçš„æŒ‰éˆ•åŠ ä¸Š active æ¨£å¼
            if (tabName === 'requests') {
                btn.classList.add('active-req'); // æ©˜è‰²æ¨£å¼
            } else {
                btn.classList.add('active');     // æ·±è—è‰²æ¨£å¼
            }
        }
    </script>
</body>
</html>