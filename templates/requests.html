<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾µç‰©å…¬ä½ˆæ¬„ - NCU äºŒæ‰‹å¸‚é›†</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        /* å¾µç‰©å°ˆç”¨çš„å¡ç‰‡æ¨£å¼ */
        .req-card {
            background: #fff; border-left: 5px solid #e67e22; /* æ©˜è‰²ä»£è¡¨å¾µæ±‚ */
            padding: 15px; margin-bottom: 15px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .req-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .req-title { font-size: 1.2em; font-weight: bold; color: #333; }
        .req-budget { background: #e67e22; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.9em; }
        .req-meta { font-size: 0.85em; color: #888; margin-bottom: 10px; }
        .req-desc { color: #555; line-height: 1.5; background: #fafafa; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <a href="{{ url_for('home') }}" style="text-decoration:none; color:#666;">â† å›å•†å“å¸‚é›†</a>
            <h1 style="margin: 0; color: #e67e22;">ğŸ™‹â€â™‚ï¸ å¾µç‰©å…¬ä½ˆæ¬„</h1>
            <div>
                {% if current_user.is_authenticated %}
                    <a href="{{ url_for('dashboard') }}" style="text-decoration:none;">ğŸ’¼ æˆ‘çš„ç®¡ç†</a>
                {% else %}
                    <a href="{{ url_for('login') }}" class="btn-primary" style="width:auto;">ç™»å…¥</a>
                {% endif %}
            </div>
        </div>

        {% if current_user.is_authenticated %}
            <button onclick="toggleReqForm()" class="btn-primary" style="background-color: #e67e22; margin-bottom: 20px;">
                â• æˆ‘æƒ³å¾µæ±è¥¿
            </button>

            <div id="reqFormArea" class="upload-card" style="display: none; border-top: 3px solid #e67e22;">
                <h3 style="margin-top:0;">ç™¼ä½ˆå¾µæ±‚éœ€æ±‚</h3>
                <form method="POST">
                    <div class="form-group">
                        <label>æˆ‘æƒ³å¾µ...</label>
                        <input type="text" name="title" placeholder="ä¾‹å¦‚ï¼šå¾®ç©åˆ†èª²æœ¬ã€äºŒæ‰‹è¢å¹•" required>
                    </div>
                    <div class="form-group">
                        <label>é ç®—ç¯„åœ</label>
                        <input type="text" name="budget" placeholder="ä¾‹å¦‚ï¼š500å…ƒä»¥å…§ã€å¯è­°åƒ¹" required>
                    </div>
                    <div class="form-group">
                        <label>è©³ç´°èªªæ˜</label>
                        <textarea name="description" placeholder="è«‹æè¿°ç‰©å“ç‹€æ³è¦æ±‚ï¼Œä¾‹å¦‚ï¼šå…«æˆæ–°ã€ç„¡ç­†è·¡..." style="width: 95%; height: 80px; padding: 10px;"></textarea>
                    </div>
                    <div class="form-group">
                        <label>è¯çµ¡æ–¹å¼</label>
                        <div class="contact-group">
                            <select name="contact_type">
                                <option value="line">Line ID</option>
                                <option value="phone">æ‰‹æ©Ÿè™Ÿç¢¼</option>
                            </select>
                            <input type="text" name="contact_info" required>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary" style="background-color: #e67e22;">å¼µè²¼å…¬å‘Š</button>
                </form>
            </div>
            <script>
                function toggleReqForm() {
                    var x = document.getElementById("reqFormArea");
                    x.style.display = (x.style.display === "none") ? "block" : "none";
                }
            </script>
        {% endif %}

        {% for r in requests %}
            <div class="req-card">
                <div class="req-header">
                    <div class="req-title">{{ r['title'] }}</div>
                    <div class="req-budget">ğŸ’° é ç®—ï¼š{{ r['budget'] }}</div>
                </div>
                <div class="req-meta">
                    <span style="margin-right: 15px;">ğŸ‘¤ å¾µæ±‚è€…ï¼š{{ r['buyer_name'] }}</span>
                    <span>ğŸ•’ {{ r['created_at'] }}</span>
                </div>
                <div class="req-desc">
                    {{ r['description'] }}
                </div>
                
                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    {% if current_user.is_authenticated %}
                        {% if r['user_id'] != current_user.id %}
                            <a href="{{ url_for('chat_room', target_id=r['user_id']) }}" class="btn-contact" style="background-color: #8e44ad; color: white; width: auto; padding: 5px 15px;">
                                ğŸ’¬ ç§è¨Šä»–
                            </a>
                            {% if r['contact_type'] == 'line' %}
                                <a href="https://line.me/ti/p/~{{ r['contact_info'] }}" target="_blank" class="btn-contact btn-line" style="width: auto; padding: 5px 15px;">Line</a>
                            {% else %}
                                <a href="tel:{{ r['contact_info'] }}" class="btn-contact btn-phone" style="width: auto; padding: 5px 15px;">é›»è©±</a>
                            {% endif %}
                        {% endif %}
                    {% else %}
                        <span style="color:#888; font-size:0.9em;">(ç™»å…¥å¾ŒæŸ¥çœ‹è¯çµ¡æ–¹å¼)</span>
                    {% endif %}
                </div>
            </div>
        {% else %}
            <div style="text-align: center; color: #999; margin-top: 50px;">
                ç›®å‰æ²’æœ‰äººåœ¨å¾µæ±è¥¿ï¼Œä½ æ˜¯ç¬¬ä¸€å€‹ï¼
            </div>
        {% endfor %}
    </div>
</body>
</html>